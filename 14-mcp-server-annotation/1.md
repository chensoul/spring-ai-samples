---
title: "Spring AI MCP Annotations 使用"
date: 2026-02-06
slug: spring-ai-mcp-annotations
categories: ["ai"]
tags: ['spring-ai', 'mcp']
---

本文介绍如何在 Spring AI 中使用 **MCP Annotations**：通过 **@McpTool**、**@McpResource**、**@McpPrompt**、**@McpComplete** 等注解声明式实现 MCP 服务端，由注解扫描自动注册并生成 JSON Schema，减少手写 `ToolCallback` 与 Bean 注册。示例 [14-mcp-server-annotation](https://github.com/chensoul/spring-ai-samples/tree/main/14-mcp-server-annotation) 使用 **Spring AI 1.1.2**（MCP Annotations 自 1.1.x 提供），基于 **spring-ai-starter-mcp-server** 与 STDIO 传输。

<!--more-->

> **示例代码库**
>
> 您可以在 [GitHub 仓库](https://github.com/chensoul/spring-ai-samples/tree/main/14-mcp-server-annotation) 中找到本文的示例代码。

## 为什么需要 MCP Annotations

在 10-mcp-server-stdio 中，我们使用 **@Tool**（Spring AI Tool）和 **ToolCallbacks.from(tools)** 手动注册工具。**MCP Annotations** 的做法是：

1. **声明式工具**：用 **@McpTool** 标记方法，用 **@McpToolParam** 描述参数，框架自动生成 MCP 工具规格与 JSON Schema。
2. **自动扫描**：启用 `spring.ai.mcp.server.annotation-scanner.enabled=true` 后，扫描带 MCP 注解的 Bean 并注册，无需 `@Bean List<ToolCallback>`。
3. **资源 / 提示 / 补全**：除 **@McpTool** 外，还可使用 **@McpResource**（URI 模板资源）、**@McpPrompt**（提示模板）、**@McpComplete**（补全），以及客户端侧的 **@McpLogging**、**@McpProgress** 等。

本示例使用 **Spring AI 1.1.2**（其他模块为 1.0.3），因 MCP Annotations 模块与注解扫描在 1.1.x 中提供；依赖 **spring-ai-starter-mcp-server**，传输为 **STDIO**（需设置 `spring.ai.mcp.server.protocol=STDIO` 避免加载 SSE/Servlet 环境）。

## 项目结构概览

- **McpAnnotationsApplication**：Spring Boot 入口。
- **CalculatorTools**：带 **@McpTool** 的组件，提供 add、subtract、multiply、divide 四个工具。
- **application.properties**：MCP 服务名、版本、type=SYNC、protocol=STDIO、annotation-scanner 启用。

## 依赖与配置

**pom.xml** 使用 Spring AI 1.1.2 与 MCP Server 起步依赖：

```xml
<properties>
    <spring-ai.version>1.1.2</spring-ai.version>
</properties>
<dependencies>
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-mcp-server</artifactId>
    </dependency>
</dependencies>
```

**application.properties** 要点：

```properties
spring.main.web-application-type=none
spring.ai.mcp.server.name=mcp-annotations-server
spring.ai.mcp.server.version=0.0.1
spring.ai.mcp.server.type=SYNC
# 仅 STDIO 传输，避免 SSE 需要 Servlet 环境
spring.ai.mcp.server.protocol=STDIO
spring.ai.mcp.server.annotation-scanner.enabled=true
spring.main.banner-mode=off
```

## 使用 @McpTool 与 @McpToolParam

将工具类标为 **@Component**，方法标为 **@McpTool**，参数标为 **@McpToolParam**（description、required），框架会生成 MCP 工具规格并参与 JSON Schema：

```java
@Component
public class CalculatorTools {

    @McpTool(name = "add", description = "Add two numbers")
    public double add(
            @McpToolParam(description = "First number", required = true) double a,
            @McpToolParam(description = "Second number", required = true) double b) {
        return a + b;
    }

    @McpTool(name = "subtract", description = "Subtract two numbers")
    public double subtract(
            @McpToolParam(description = "Minuend", required = true) double a,
            @McpToolParam(description = "Subtrahend", required = true) double b) {
        return a - b;
    }
    // multiply, divide 同理
}
```

- **name**、**description** 会出现在 MCP 工具列表中，供客户端与模型使用。
- 方法参数仅保留带 **@McpToolParam** 的（或框架约定参与 schema 的），特殊参数如 **McpSyncRequestContext**、**McpTransportContext** 会被注入且不参与 schema。
- 同步服务器（type=SYNC）使用普通返回值；异步服务器（type=ASYNC）可使用 **Mono**/ **Flux** 返回值。

## 其他服务端注解（简介）

- **@McpResource(uri = "template://{id}", ...)**：按 URI 模板提供资源，方法参数对应模板变量，可返回 **ReadResourceResult**。
- **@McpPrompt(name = "xxx", description = "xxx")**：提供提示模板，参数用 **@McpArg**，返回 **GetPromptResult**。
- **@McpComplete(prompt = "xxx")**：为某提示提供补全，返回 **List&lt;String&gt;** 或 **CompleteResult**。

客户端侧可用的注解包括 **@McpLogging**、**@McpSampling**、**@McpProgress**、**@McpToolListChanged** 等，用于处理服务端发来的日志、采样请求、进度、工具列表变更等。

## 运行与连接

**仅 STDIO**，无 HTTP：

```bash
cd 14-mcp-server-annotation && ../mvnw spring-boot:run
```

使用 11-mcp-client-stdio 等客户端时，在 **mcp-servers.json** 中配置本服务进程命令（如指向本模块 jar 或 `mvn spring-boot:run` 的脚本），即可发现 add、subtract、multiply、divide 四个工具并调用。

## 小结

- Spring AI **MCP Annotations**（1.1.x）通过 **@McpTool**、**@McpResource**、**@McpPrompt**、**@McpComplete** 等声明式实现 MCP 服务端，并由注解扫描自动注册与生成 JSON Schema。
- 本示例使用 **spring-ai-starter-mcp-server**、**protocol=STDIO**、**type=SYNC**，仅需 **@Component** + **@McpTool** / **@McpToolParam** 即可暴露计算器工具，无需手写 **ToolCallback** 或 **@Bean** 列表。
