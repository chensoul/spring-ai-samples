---
title: "Spring Authorization Server 与 MCP OAuth 2.1"
date: 2026-02-03
slug: spring-ai-mcp-authorization-server
categories: ["ai"]
tags: ['spring-ai', 'mcp', 'oauth2', 'authorization-server']
---

本文介绍如何使用 **Spring Authorization Server** 搭建 OAuth 2.0/2.1 授权服务器，为 [Spring AI MCP Security](https://docs.spring.io/spring-ai/reference/api/mcp/mcp-security.html) 的 OAuth2 示例（MCP 服务端 JWT 资源服务器 + MCP 客户端 Client Credentials）提供 JWT issuer。示例 [17-mcp-authorization-server](https://github.com/chensoul/spring-ai-samples/tree/main/17-mcp-authorization-server) 与 18-mcp-server-oauth2、19-mcp-client-oauth2 配套使用。

<!--more-->

## 角色说明

- **17-mcp-authorization-server**：授权服务器（本模块），签发 JWT，监听 9000。
- **18-mcp-server-oauth2**：MCP 资源服务器，校验 JWT（issuer-uri 指向 9000），监听 8090。
- **19-mcp-client-oauth2**：MCP 客户端，使用 client_credentials 向 16 获取 JWT，携带 JWT 访问 17。

## 项目结构

- **McpAuthorizationServerApplication**：Spring Boot 入口。
- **AuthorizationServerConfig**：OAuth2 授权服务器配置：协议端点 SecurityFilterChain、默认登录 SecurityFilterChain、UserDetailsService、RegisteredClientRepository（mcp-client）、JWKSource、JwtDecoder。

## 依赖与配置

**pom.xml** 使用 Spring Boot 3.x 与 `spring-boot-starter-oauth2-authorization-server`：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-authorization-server</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

**application.properties**：`server.port=9000`。

## 注册客户端（RegisteredClient）

示例中注册一个客户端 `mcp-client`，供 MCP 客户端应用使用：

- **clientId**：mcp-client  
- **clientSecret**：{noop}mcp-client-secret  
- **authorizationGrantType**：CLIENT_CREDENTIALS、AUTHORIZATION_CODE  
- **scope**：openid  
- **redirectUri**：http://localhost:8080/login/oauth2/code/mcp-client（authorization_code 时使用）

生产环境应使用持久化 `RegisteredClientRepository` 并妥善保管 client secret。

## JWK 与 JWT

使用 RSA 密钥对生成 JWKSource，授权服务器用私钥签发 JWT，资源服务器（19）通过 `issuer-uri` 拉取 JWK Set 校验签名。

## 参考

- [Spring Authorization Server Reference](https://docs.spring.io/spring-authorization-server/reference/)
- [Spring AI MCP Security - OAuth 2.0 Configuration](https://docs.spring.io/spring-ai/reference/api/mcp/mcp-security.html)
- [mcp-security/samples](https://github.com/spring-ai-community/mcp-security/tree/main/samples)（OAuth2 相关示例）
